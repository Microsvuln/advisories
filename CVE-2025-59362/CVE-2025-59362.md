## [Product]
Squid Web Proxy Cache - Version 7.1-VCS

## [CVE identifier]
CVE-2025-59362

### [Description]

A stack-based buffer overflow vulnerability exists in the SNMP (Simple Network Management Protocol) message processing component of Squid Cache. The flaw is present in the asn_build_objid function located in the lib/snmplib/asn1.c library, which is responsible for encoding Object Identifiers (OIDs) into the ASN.1 BER format for SNMP responses.



### [Affected Component]
Squid, snmp



### [Attack Type]
Remote



### [Impact Denial of Service]
true



### [Reference]
https://github.com/squid-cache/squid/pull/2149



### [ADDITIONAL INFORMATION]
```
2025/08/28 03:34:04| Processing Configuration File: /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/etc/squid/squid.conf (depth 0)
2025/08/28 03:34:04| WARNING: Ignoring 127.0.0.1 because it is already covered by 127.0.0.1
    advice: Remove value 127.0.0.1 from the ACL
    acl name: localhost
    configuration context: sh/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/etc/squid/squid.conf(8) acl
2025/08/28 03:34:04| WARNING: Ignoring ::1 because it is already covered by ::1
    advice: Remove value ::1 from the ACL
    acl name: localhost
    configuration context: sh/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/etc/squid/squid.conf(8) acl
2025/08/28 03:34:04| Created PID file (/home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/var/run/squid.pid)
2025/08/28 03:34:04| Set Current Directory to /tmp/squid-coredumps
2025/08/28 03:34:04| Starting Squid Cache version 7.1-VCS for x86_64-pc-linux-gnu...
2025/08/28 03:34:04| Service Name: squid
2025/08/28 03:34:04| Process ID 301221
2025/08/28 03:34:04| Process Roles: master worker
2025/08/28 03:34:04| With 1024 file descriptors available
2025/08/28 03:34:04| Initializing IP Cache...
2025/08/28 03:34:04| DNS IPv6 socket created at [::], FD 8
2025/08/28 03:34:04| DNS IPv4 socket created at 0.0.0.0, FD 9
2025/08/28 03:34:04| Adding nameserver 127.0.0.53 from /etc/resolv.conf
2025/08/28 03:34:04| Adding domain localdomain from /etc/resolv.conf
2025/08/28 03:34:04| Logfile: opening log daemon:/home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/var/logs/access.log
2025/08/28 03:34:04| Logfile Daemon: opening log /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/var/logs/access.log
2025/08/28 03:34:04| WARNING: no_suid: setuid(0): (1) Operation not permitted
2025/08/28 03:34:04| Store logging disabled
2025/08/28 03:34:04| Swap maxSize 0 + 262144 KB, estimated 20164 objects
2025/08/28 03:34:04| Target number of buckets: 1008
2025/08/28 03:34:04| Using 8192 Store buckets
2025/08/28 03:34:04| Max Mem  size: 262144 KB
2025/08/28 03:34:04| Max Swap size: 0 KB
2025/08/28 03:34:04| Using Least Load store dir selection
2025/08/28 03:34:04| Set Current Directory to /tmp/squid-coredumps
2025/08/28 03:34:04| Finished loading MIME types and icons.
2025/08/28 03:34:04| HTCP Disabled.
2025/08/28 03:34:04| Sending SNMP messages from [::]:3401
2025/08/28 03:34:04| Squid plugin modules loaded: 0
2025/08/28 03:34:04| Adaptation support is off.
2025/08/28 03:34:04| Accepting HTTP Socket connections at conn3 local=[::]:3128 remote=[::] FD 12 flags=9
    listening port: 3128
2025/08/28 03:34:04| Accepting SNMP messages on [::]:3401
2025/08/28 03:34:05| storeLateRelease: released 0 objects
=================================================================
==301221==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7fff57c3a860 at pc 0x5ffac568e936 bp 0x7fff57c3a7b0 sp 0x7fff57c3a7a8
WRITE of size 1 at 0x7fff57c3a860 thread T0
    #0 0x5ffac568e935 in asn_build_objid /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/asn1.c:773:23
    #1 0x5ffac568a6de in snmp_var_EncodeVarBind /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/snmp_vars.c:285:16
    #2 0x5ffac5688e3c in snmp_msg_Encode /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/snmp_msg.c:208:12
    #3 0x5ffac5688659 in snmp_build /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/snmp_api.c:110:12
    #4 0x5ffac4d8cea5 in snmpConstructReponse(SnmpRequest*) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/snmp_core.cc:448:9
    #5 0x5ffac4d8cea5 in snmpDecodePacket(SnmpRequest*) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/snmp_core.cc:413:13
    #6 0x5ffac4d8cea5 in snmpHandleUdp(int, void*) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/snmp_core.cc:371:9
    #7 0x5ffac542c099 in Comm::DoSelect(int) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/comm/../../../src/comm/ModEpoll.cc:266:17
    #8 0x5ffac535d32d in CommSelectEngine::checkEvents(int) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/comm.cc:1669:13
    #9 0x5ffac4dd533a in EventLoop::checkEngine(AsyncEngine*, bool) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/EventLoop.cc
    #10 0x5ffac4dd5b6c in EventLoop::runOnce() /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/EventLoop.cc:115:9
    #11 0x5ffac4dd5937 in EventLoop::run() /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/EventLoop.cc:83:13
    #12 0x5ffac5059be9 in SquidMain(int, char**) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/main.cc:1706:14
    #13 0x5ffac5058b41 in SquidMainSafe(int, char**) /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/main.cc:1351:16
    #14 0x5ffac5058b41 in main /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/src/../../src/main.cc:1339:12
    #15 0x759d3a229d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16
    #16 0x759d3a229e3f in __libc_start_main csu/../csu/libc-start.c:392:3
    #17 0x5ffac4c60ac4 in _start (/home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/install/sbin/squid+0x432ac4) (BuildId: 2cb97d16d2dcd7fe685057bebc0c7f4a1920c9ed)

Address 0x7fff57c3a860 is located in stack of thread T0 at offset 160 in frame
    #0 0x5ffac568e31f in asn_build_objid /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/asn1.c:730

  This frame has 1 object(s):
    [32, 160) 'buf' (line 737) <== Memory access at offset 160 overflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow /home/arash/Documents/squid-stable/squid-SQUID_7_1/build-asan/lib/snmplib/../../../lib/snmplib/asn1.c:773:23 in asn_build_objid
Shadow bytes around the buggy address:
  0x10006af7f4b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f4c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f4d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f4e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f4f0: 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00 00 00 00
=>0x10006af7f500: 00 00 00 00 00 00 00 00 00 00 00 00[f3]f3 f3 f3
  0x10006af7f510: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f520: 00 00 00 00 f1 f1 f1 f1 04 f3 f3 f3 00 00 00 00
  0x10006af7f530: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10006af7f540: f1 f1 f1 f1 04 f2 04 f3 00 00 00 00 00 00 00 00
  0x10006af7f550: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==301221==ABORTING


```

### [Credit]
Arash Ale Ebrahim (@microsvuln) from SYSPWN





